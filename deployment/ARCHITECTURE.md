# AgriPulse AI - Docker Architecture Diagrams

Visual reference for understanding the Docker deployment architecture.

## ğŸ—ï¸ System Architecture

### High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Internet / Users                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ HTTP/HTTPS
                               â”‚ Port 8501
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Docker Host Server                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              AgriPulse AI Container                      â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚         Streamlit Web Server                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚         (Port 8501)                              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                        â†“                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚      Multi-Agent System (Google ADK)            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Coordinator  â”‚  â”‚   Weather    â”‚           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    Agent     â”‚â†’ â”‚    Agent     â”‚           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚         â†“                  â†“                    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    Yield     â”‚  â”‚  Discovery   â”‚           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚    Agent     â”‚  â”‚    Tools     â”‚           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Mounted Volumes:                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ /app/secrets (Snowflake Private Key)              â”‚   â”‚
â”‚  â”‚  â””â”€â”€ /app/logs (Application Logs)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                   â”‚
                        â†“                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Google AI API       â”‚  â”‚  Snowflake DB    â”‚
        â”‚   (Gemini Models)     â”‚  â”‚  (ML Forecasts)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ³ Docker Container Architecture

### Multi-Stage Build Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STAGE 1: BUILDER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Base Image: python:3.13-slim                                    â”‚
â”‚                                                                   â”‚
â”‚  1. Install build dependencies                                   â”‚
â”‚     â”œâ”€â”€ build-essential                                          â”‚
â”‚     â”œâ”€â”€ curl                                                     â”‚
â”‚     â””â”€â”€ git                                                      â”‚
â”‚                                                                   â”‚
â”‚  2. Install uv (fast Python package installer)                   â”‚
â”‚                                                                   â”‚
â”‚  3. Create virtual environment (/opt/venv)                       â”‚
â”‚                                                                   â”‚
â”‚  4. Install Python dependencies                                  â”‚
â”‚     â”œâ”€â”€ google-adk                                               â”‚
â”‚     â”œâ”€â”€ streamlit                                                â”‚
â”‚     â”œâ”€â”€ snowflake                                                â”‚
â”‚     â””â”€â”€ other packages from pyproject.toml                       â”‚
â”‚                                                                   â”‚
â”‚  Size: ~2-3GB (temporary)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    Copy virtual environment
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STAGE 2: RUNTIME                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Base Image: python:3.13-slim                                    â”‚
â”‚                                                                   â”‚
â”‚  1. Copy virtual environment from builder                        â”‚
â”‚     â””â”€â”€ /opt/venv â†’ /opt/venv                                    â”‚
â”‚                                                                   â”‚
â”‚  2. Copy application code                                        â”‚
â”‚     â”œâ”€â”€ adk_app/                                                 â”‚
â”‚     â”œâ”€â”€ main.py                                                  â”‚
â”‚     â””â”€â”€ pyproject.toml                                           â”‚
â”‚                                                                   â”‚
â”‚  3. Create non-root user (agripulse:1000)                        â”‚
â”‚                                                                   â”‚
â”‚  4. Configure health checks                                      â”‚
â”‚                                                                   â”‚
â”‚  5. Set environment variables                                    â”‚
â”‚                                                                   â”‚
â”‚  Final Size: ~1-2GB (60% smaller!)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Runtime Container Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AgriPulse Container                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  /opt/venv/                    â† Virtual Environment             â”‚
â”‚  â”œâ”€â”€ bin/                                                        â”‚
â”‚  â”‚   â”œâ”€â”€ python                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ streamlit                                               â”‚
â”‚  â”‚   â””â”€â”€ ...                                                     â”‚
â”‚  â””â”€â”€ lib/python3.13/site-packages/                              â”‚
â”‚      â”œâ”€â”€ google/                                                 â”‚
â”‚      â”œâ”€â”€ streamlit/                                              â”‚
â”‚      â”œâ”€â”€ snowflake/                                              â”‚
â”‚      â””â”€â”€ ...                                                     â”‚
â”‚                                                                   â”‚
â”‚  /app/                         â† Application Code                â”‚
â”‚  â”œâ”€â”€ adk_app/                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ agents/                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ tools/                                                  â”‚
â”‚  â”‚   â””â”€â”€ core/                                                   â”‚
â”‚  â”œâ”€â”€ main.py                                                     â”‚
â”‚  â”œâ”€â”€ pyproject.toml                                              â”‚
â”‚  â””â”€â”€ .streamlit/config.toml                                      â”‚
â”‚                                                                   â”‚
â”‚  /app/secrets/                 â† Mounted Volume (Read-Only)      â”‚
â”‚  â””â”€â”€ snowflake_key.pem                                           â”‚
â”‚                                                                   â”‚
â”‚  /app/logs/                    â† Mounted Volume (Read-Write)     â”‚
â”‚  â””â”€â”€ *.log                                                       â”‚
â”‚                                                                   â”‚
â”‚  User: agripulse (UID 1000)   â† Non-root execution              â”‚
â”‚  Port: 8501                    â† Exposed to host                 â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ Network Architecture

### Production Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Docker Host                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           agripulse-network (Bridge)                    â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  agripulse-app                                    â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  IP: 172.18.0.2                                   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Port: 8501                                       â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â†‘                                     â”‚
â”‚                            â”‚                                     â”‚
â”‚                    Port Mapping                                  â”‚
â”‚                    Host:8501 â†’ Container:8501                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
                    External Access
                    http://localhost:8501
```

### With Monitoring Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Docker Host                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           agripulse-network (Bridge)                    â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ agripulse-appâ”‚  â”‚  prometheus  â”‚  â”‚   grafana   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   :8501      â”‚â†â”€â”‚    :9090     â”‚â†â”€â”‚    :3000    â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚         â†‘                  â†‘                           â”‚    â”‚
â”‚  â”‚         â”‚                  â”‚                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚   cadvisor   â”‚  â”‚node-exporter â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚    :8080     â”‚  â”‚    :9100     â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  Port Mappings:                                                  â”‚
â”‚  â”œâ”€â”€ 8501 â†’ AgriPulse App                                       â”‚
â”‚  â”œâ”€â”€ 9090 â†’ Prometheus                                          â”‚
â”‚  â”œâ”€â”€ 3000 â†’ Grafana                                             â”‚
â”‚  â”œâ”€â”€ 8080 â†’ cAdvisor                                            â”‚
â”‚  â””â”€â”€ 9100 â†’ Node Exporter                                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Architecture

### User Request Flow

```
1. User Browser
   â”‚
   â”‚ HTTP Request
   â†“
2. Docker Host (Port 8501)
   â”‚
   â”‚ Port Mapping
   â†“
3. AgriPulse Container
   â”‚
   â”‚ Streamlit Server
   â†“
4. Coordinator Agent
   â”‚
   â”œâ”€â†’ Weather Query?
   â”‚   â”‚
   â”‚   â†“
   â”‚   Weather Agent
   â”‚   â”‚
   â”‚   â”‚ API Call
   â”‚   â†“
   â”‚   OpenWeather API
   â”‚   â”‚
   â”‚   â”‚ Weather Data
   â”‚   â†“
   â”‚   Format Response
   â”‚
   â””â”€â†’ Yield Query?
       â”‚
       â†“
       Yield Agent
       â”‚
       â”œâ”€â†’ get_yield_forecast_from_db()
       â”‚   â”‚
       â”‚   â”‚ SQL Query
       â”‚   â†“
       â”‚   Snowflake Database
       â”‚   â”‚
       â”‚   â”‚ Forecast Data
       â”‚   â†“
       â”‚   Format Results
       â”‚
       â””â”€â†’ get_crop_practice_data()
           â”‚
           â”‚ SQL Query
           â†“
           Snowflake Database
           â”‚
           â”‚ Practice Data
           â†“
           Combine & Format
           â”‚
           â†“
5. Streamlit UI
   â”‚
   â”‚ Render Response
   â†“
6. User Browser
```

## ğŸ”„ Deployment Workflow

### Build and Deploy Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPLOYMENT WORKFLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. PREPARATION
   â”œâ”€â”€ Configure .env file
   â”œâ”€â”€ Add Snowflake private key
   â””â”€â”€ Review configuration

2. BUILD PHASE
   â”‚
   â”œâ”€â”€ ./build.sh
   â”‚   â”‚
   â”‚   â”œâ”€â”€ Validate prerequisites
   â”‚   â”‚   â”œâ”€â”€ Docker installed?
   â”‚   â”‚   â”œâ”€â”€ Dockerfile exists?
   â”‚   â”‚   â””â”€â”€ pyproject.toml exists?
   â”‚   â”‚
   â”‚   â”œâ”€â”€ Execute multi-stage build
   â”‚   â”‚   â”œâ”€â”€ Stage 1: Install dependencies
   â”‚   â”‚   â””â”€â”€ Stage 2: Create runtime image
   â”‚   â”‚
   â”‚   â””â”€â”€ Tag image: agripulse-ai:latest
   â”‚
   â””â”€â”€ Build complete âœ“

3. DEPLOYMENT PHASE
   â”‚
   â”œâ”€â”€ ./deploy.sh up
   â”‚   â”‚
   â”‚   â”œâ”€â”€ Validate configuration
   â”‚   â”‚   â”œâ”€â”€ .env file exists?
   â”‚   â”‚   â”œâ”€â”€ Required variables set?
   â”‚   â”‚   â”œâ”€â”€ Secrets directory exists?
   â”‚   â”‚   â””â”€â”€ Snowflake key present?
   â”‚   â”‚
   â”‚   â”œâ”€â”€ Start services
   â”‚   â”‚   â”œâ”€â”€ Create network
   â”‚   â”‚   â”œâ”€â”€ Mount volumes
   â”‚   â”‚   â”œâ”€â”€ Start container
   â”‚   â”‚   â””â”€â”€ Wait for health check
   â”‚   â”‚
   â”‚   â””â”€â”€ Verify deployment
   â”‚       â”œâ”€â”€ Container running?
   â”‚       â”œâ”€â”€ Health check passing?
   â”‚       â””â”€â”€ Application accessible?
   â”‚
   â””â”€â”€ Deployment complete âœ“

4. VERIFICATION
   â”‚
   â”œâ”€â”€ Access http://localhost:8501
   â”œâ”€â”€ Test weather queries
   â”œâ”€â”€ Test yield predictions
   â””â”€â”€ Check logs
   
5. MONITORING (Optional)
   â”‚
   â”œâ”€â”€ docker-compose -f docker-compose.monitoring.yml up -d
   â”‚   â”‚
   â”‚   â”œâ”€â”€ Start Prometheus
   â”‚   â”œâ”€â”€ Start Grafana
   â”‚   â”œâ”€â”€ Start cAdvisor
   â”‚   â””â”€â”€ Start Node Exporter
   â”‚
   â””â”€â”€ Access dashboards
       â”œâ”€â”€ Prometheus: http://localhost:9090
       â”œâ”€â”€ Grafana: http://localhost:3000
       â””â”€â”€ cAdvisor: http://localhost:8080
```

## ğŸ”’ Security Architecture

### Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Layer 1: Network Isolation                                      â”‚
â”‚  â”œâ”€â”€ Custom Docker bridge network                                â”‚
â”‚  â”œâ”€â”€ No direct internet access from container                    â”‚
â”‚  â””â”€â”€ Only exposed ports accessible                               â”‚
â”‚                                                                   â”‚
â”‚  Layer 2: Container Security                                     â”‚
â”‚  â”œâ”€â”€ Non-root user execution (UID 1000)                          â”‚
â”‚  â”œâ”€â”€ Minimal base image (python:3.13-slim)                       â”‚
â”‚  â”œâ”€â”€ No privileged mode                                          â”‚
â”‚  â””â”€â”€ Resource limits enforced                                    â”‚
â”‚                                                                   â”‚
â”‚  Layer 3: Secrets Management                                     â”‚
â”‚  â”œâ”€â”€ Private keys in mounted volumes                             â”‚
â”‚  â”œâ”€â”€ Environment variables for config                            â”‚
â”‚  â”œâ”€â”€ No secrets in image layers                                  â”‚
â”‚  â””â”€â”€ Read-only secret mounts                                     â”‚
â”‚                                                                   â”‚
â”‚  Layer 4: Access Control                                         â”‚
â”‚  â”œâ”€â”€ File permissions enforced                                   â”‚
â”‚  â”œâ”€â”€ User isolation                                              â”‚
â”‚  â””â”€â”€ Volume mount restrictions                                   â”‚
â”‚                                                                   â”‚
â”‚  Layer 5: Application Security                                   â”‚
â”‚  â”œâ”€â”€ CORS protection                                             â”‚
â”‚  â”œâ”€â”€ XSRF protection                                             â”‚
â”‚  â”œâ”€â”€ Input validation                                            â”‚
â”‚  â””â”€â”€ Error handling                                              â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Monitoring Architecture

### Metrics Collection Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONITORING STACK                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AgriPulse Container
â”œâ”€â”€ Health Endpoint (:8501/_stcore/health)
â”‚   â””â”€â†’ Prometheus scrapes every 30s
â”‚
â”œâ”€â”€ Container Metrics
â”‚   â””â”€â†’ cAdvisor collects
â”‚       â”œâ”€â”€ CPU usage
â”‚       â”œâ”€â”€ Memory usage
â”‚       â”œâ”€â”€ Network I/O
â”‚       â””â”€â”€ Disk I/O
â”‚
â””â”€â”€ System Metrics
    â””â”€â†’ Node Exporter collects
        â”œâ”€â”€ CPU stats
        â”œâ”€â”€ Memory stats
        â”œâ”€â”€ Disk stats
        â””â”€â”€ Network stats

All metrics â†’ Prometheus (Time-series DB)
                    â†“
              Grafana (Visualization)
                    â†“
              Dashboards & Alerts
```

## ğŸ”„ Update and Maintenance Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UPDATE WORKFLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Code Update
   â”œâ”€â”€ git pull
   â””â”€â”€ Review changes

2. Rebuild Image
   â”œâ”€â”€ ./build.sh --no-cache
   â””â”€â”€ New image created

3. Zero-Downtime Update (Optional)
   â”œâ”€â”€ Scale up new version
   â”‚   â””â”€â”€ docker-compose up -d --scale agripulse-app=2
   â”œâ”€â”€ Verify new container healthy
   â””â”€â”€ Remove old container

4. Standard Update
   â”œâ”€â”€ ./deploy.sh down
   â”œâ”€â”€ ./deploy.sh up
   â””â”€â”€ Verify deployment

5. Rollback (if needed)
   â”œâ”€â”€ docker tag agripulse-ai:previous agripulse-ai:latest
   â”œâ”€â”€ ./deploy.sh down
   â””â”€â”€ ./deploy.sh up
```

---

## ğŸ“ Legend

```
â”Œâ”€â”€â”€â”€â”€â”
â”‚ Box â”‚  = Component/Container
â””â”€â”€â”€â”€â”€â”˜

  â†“     = Data/Control flow

  â†’     = Connection/Relationship

  â”œâ”€â”€   = Branch/Option

  :8501 = Port number

  âœ“     = Completed/Success
```

---

**Version:** 1.0.0  
**Last Updated:** 2025-10-07  
**For:** AgriPulse AI Docker Deployment
